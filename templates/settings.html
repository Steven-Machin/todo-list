{% extends "base.html" %}
{% block title %}Settings{% endblock %}
{% block head_extra %}{% endblock %}
{% block content %}
  <div class="container">
    <h1>Settings</h1>

    <form class="card" method="post" action="{{ url_for('settings_update') }}">
      <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
      <h2>Profile</h2>
      <div class="form-row">
        <label for="display_name">Display Name</label>
        <input type="text" id="display_name" name="display_name"
               placeholder="Your name"
               value="{{ my_prefs.display_name or effective_display }}">
        <small class="hint">Shown in chats and task lists.</small>
      </div>

      <hr class="divider">

      <h2>Appearance</h2>
      <div class="grid-2">
        <div class="form-row">
          <label for="theme">Theme</label>
          <select id="theme" name="theme">
            <option value="light"  {% if my_prefs.theme == 'light' %}selected{% endif %}>Light</option>
            <option value="dark"   {% if my_prefs.theme == 'dark' %}selected{% endif %}>Dark</option>
          </select>
        </div>
        <div class="form-row">
          <label for="density">Density</label>
          <select id="density" name="density">
            <option value="comfortable" {% if my_prefs.density == 'comfortable' %}selected{% endif %}>Comfortable</option>
            <option value="compact"     {% if my_prefs.density == 'compact' %}selected{% endif %}>Compact</option>
          </select>
        </div>
      </div>

      <hr class="divider">

      <h2>Calendar</h2>
      <div class="form-row">
        <label for="calendar_scope">Default Scope</label>
        <select id="calendar_scope" name="calendar_scope">
          <option value="my"  {% if my_prefs.calendar_scope == 'my' %}selected{% endif %}>My items</option>
          <option value="all" {% if my_prefs.calendar_scope == 'all' %}selected{% endif %}>All (managers only)</option>
        </select>
        <small class="hint">Non-managers will always see only their items.</small>
      </div>

      <hr class="divider">

      <h2>Notifications</h2>
      <div class="form-row checkbox-row">
        <label class="checkbox">
          <input type="checkbox" name="notify_sound" value="1"
                 {% if my_prefs.notify_sound %}checked{% endif %}>
          <span>Play a sound for new chat messages</span>
        </label>
      </div>

      <div class="actions">
        <button type="submit">Save Settings</button>
        <a class="button-secondary" href="{{ url_for('index') }}">Cancel</a>
      </div>

      <div class="form-row">
        <small class="hint">Configure email or Discord alerts on the <a href="{{ url_for('notifications_settings') }}">Notifications page</a>.</small>
      </div>
    </form>

    <div class="card subtle">
      <h3>Account</h3>
      <p>Forgot your password? <a href="{{ url_for('forgot') }}">Reset it here</a>.</p>
    </div>
  </div>
{% endblock %}
{% block scripts %}
  {{ super() }}
  <script>
    (function () {
      const select = document.getElementById('theme');
      if (!select) { return; }
      select.addEventListener('change', function (ev) {
        if (window.applyTheme) {
          window.applyTheme(ev.target.value, { persistLocal: true, notifyServer: false });
        } else {
          document.body.classList.remove('theme-light', 'theme-dark');
          document.body.classList.add('theme-' + ev.target.value);
        }
      });
    })();
  </script>
{% endblock %}
