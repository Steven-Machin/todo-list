<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Settings</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
</head>
<body class="theme-{{ my_prefs.theme|default('light') }}">
  <!-- Sidebar -->
  <div class="sidebar">
    <h2>Menu</h2>
    <a href="{{ url_for('index') }}">Home</a>
    <a href="{{ url_for('calendar_view') }}">Calendar</a>
    <a href="{{ url_for('overdue_tasks') }}">Overdue Tasks</a>

    {# Chats link: managers -> group manager; members -> chats hub #}
    {% if current_role == 'manager' %}
      <a href="{{ url_for('group_chat_manager') }}">Group Chats</a>
      <a href="{{ url_for('tasks_page') }}">Task Manager</a>
      <a href="{{ url_for('team_member_manager') }}">Team Member Manager</a>
      <a href="{{ url_for('view_shifts') }}">Shifts</a>
    {% else %}
      <a href="{{ url_for('chats') }}">Group Chats</a>
    {% endif %}

    <a class="active" href="{{ url_for('settings') }}">Settings</a>
    <a href="{{ url_for('logout') }}" onclick="return confirm('Are you sure you want to log out?');">Logout</a>
  </div>

  <!-- Main -->
  <div class="main-content container">
    <h1>Settings</h1>

    {% with msgs = get_flashed_messages() %}
      {% if msgs %}
        <div class="flash-area">
          {% for m in msgs %}
            <div class="flash">{{ m }}</div>
          {% endfor %}
        </div>
      {% endif %}
    {% endwith %}

    <form class="card" method="post" action="{{ url_for('settings_update') }}">
      <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
      <h2>Profile</h2>
      <div class="form-row">
        <label for="display_name">Display Name</label>
        <input type="text" id="display_name" name="display_name"
               placeholder="Your name"
               value="{{ my_prefs.display_name or effective_display }}">
        <small class="hint">Shown in chats and task lists.</small>
      </div>

      <hr class="divider">

      <h2>Appearance</h2>
      <div class="grid-2">
        <div class="form-row">
          <label for="theme">Theme</label>
          <select id="theme" name="theme">
            <option value="light"  {% if my_prefs.theme == 'light' %}selected{% endif %}>Light</option>
            <option value="dark"   {% if my_prefs.theme == 'dark' %}selected{% endif %}>Dark</option>
          </select>
        </div>
        <div class="form-row">
          <label for="density">Density</label>
          <select id="density" name="density">
            <option value="comfortable" {% if my_prefs.density == 'comfortable' %}selected{% endif %}>Comfortable</option>
            <option value="compact"     {% if my_prefs.density == 'compact' %}selected{% endif %}>Compact</option>
          </select>
        </div>
      </div>

      <hr class="divider">

      <h2>Calendar</h2>
      <div class="form-row">
        <label for="calendar_scope">Default Scope</label>
        <select id="calendar_scope" name="calendar_scope">
          <option value="my"  {% if my_prefs.calendar_scope == 'my' %}selected{% endif %}>My items</option>
          <option value="all" {% if my_prefs.calendar_scope == 'all' %}selected{% endif %}>All (managers only)</option>
        </select>
        <small class="hint">Non-managers will always see only their items.</small>
      </div>

      <hr class="divider">

      <h2>Notifications</h2>
      <div class="form-row checkbox-row">
        <label class="checkbox">
          <input type="checkbox" name="notify_sound" value="1"
                 {% if my_prefs.notify_sound %}checked{% endif %}>
          <span>Play a sound for new chat messages</span>
        </label>
      </div>

      <div class="actions">
        <button type="submit">Save Settings</button>
        <a class="button-secondary" href="{{ url_for('index') }}">Cancel</a>
      </div>
    </form>

    <div class="card subtle">
      <h3>Account</h3>
      <p>Forgot your password? <a href="{{ url_for('forgot') }}">Reset it here</a>.</p>
    </div>
  </div>
</body>
</html>
