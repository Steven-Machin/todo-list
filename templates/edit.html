{% extends "base.html" %}
{% block title %}Edit Task{% endblock %}
{% block content %}
<div class="container-xl py-4">
  <div class="card shadow-sm border-0">
    <div class="card-body">
      <h1 class="h4 mb-4">Edit Task</h1>
      <form class="row g-3" action="{{ url_for('edit', task_id=task_id) }}" method="post">
        <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">

        <div class="col-12">
          <label class="form-label" for="task">Task description</label>
          <input class="form-control" id="task" type="text" name="task" value="{{ task.text }}" required>
        </div>

        <div class="col-md-4">
          <label class="form-label" for="priority">Priority</label>
          <select class="form-select" id="priority" name="priority">
            <option value="Low" {% if task.priority == 'Low' %}selected{% endif %}>Low</option>
            <option value="Medium" {% if task.priority == 'Medium' %}selected{% endif %}>Medium</option>
            <option value="High" {% if task.priority == 'High' %}selected{% endif %}>High</option>
          </select>
        </div>

        <div class="col-md-4">
          <label class="form-label" for="assigned_to">Assign to</label>
          {% set selected_assignee = (task.assigned_username or task.assigned_to or '')|lower %}
          <select class="form-select" id="assigned_to" name="assigned_to">
            <option value="" {% if not selected_assignee %}selected{% endif %}>-- Unassigned --</option>
            {% for user in assignable_users %}
              {% set username_lower = user.username|lower %}
              <option value="{{ user.username }}" {% if username_lower == selected_assignee %}selected{% endif %}>{{ user.display_name }}</option>
            {% endfor %}
          </select>
        </div>

        <div class="col-md-4">
          <label class="form-label" for="due_date">Due date</label>
          {% set due_value = task.due_date or task.due %}
          <input class="form-control" id="due_date" type="date" name="due_date" value="{{ due_value }}">
        </div>

        <div class="col-12">
          <label class="form-label" for="tags">Tags</label>
          <input class="form-control" id="tags" type="text" name="tags" value="{{ task.tags|join(', ') }}" placeholder="Example: payroll, q2, vip">
          <div class="form-text">Separate tags with commas.</div>
        </div>

        <div class="col-12">
          <label class="form-label" for="notes">Notes</label>
          <textarea class="form-control" id="notes" name="notes" rows="4" placeholder="Optional notes or context">{{ task.notes }}</textarea>
        </div>

        <div class="col-12 d-flex justify-content-end gap-2">
          <a class="btn btn-outline-secondary" href="{{ url_for('tasks_page') }}">Cancel</a>
          <button class="btn btn-primary" type="submit">Save Changes</button>
        </div>
      </form>
    </div>
  </div>
</div>
{% endblock %}
