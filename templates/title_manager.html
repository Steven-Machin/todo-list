{% extends "base.html" %}
{% block title %}Team Member Manager{% endblock %}
{% block content %}
  <div class="container">
    <h1>Team Member Manager</h1>

    {% if categorized['Untitled'] %}
      <h2>Untitled</h2>
      <ul>
        {% for user in categorized['Untitled'] %}
          <li>
            <strong>{{ user.display_name }}</strong><br>
            <form method="post" action="{{ url_for('update_titles') }}" class="inline-form">
              <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
              <label>Add title:</label>
              <select name="add_title_{{ user.username }}">
                <option value="">-- Select --</option>
                {% for t in all_titles %}
                  <option value="{{ t }}">{{ t }}</option>
                {% endfor %}
              </select>
              <button type="submit">Save</button>
            </form>
          </li>
        {% endfor %}
      </ul>
    {% endif %}

    {% for title, group in categorized.items() if title != 'Untitled' %}
      <h2>{{ title }}</h2>
      <ul>
        {% for user in group %}
          <li>
            <strong>{{ user.display_name }}</strong><br>
            <small>Current Titles:</small>
            {% for t in user.titles %}
              <span class="title-badge">
                {{ t }}
                <form method="post" action="{{ url_for('update_titles') }}" class="remove-form" style="display:inline">
                  <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
                  <input type="hidden" name="remove_title_{{ user.username }}" value="{{ t }}">
                  <button type="submit" class="remove-btn">remove</button>
                </form>
              </span>
            {% endfor %}

            <form method="post" action="{{ url_for('update_titles') }}" class="inline-form" style="margin-top:4px">
              <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
              <label>Add title:</label>
              <select name="add_title_{{ user.username }}">
                <option value="">-- Select --</option>
                {% for t in all_titles if t not in user.titles %}
                  <option value="{{ t }}">{{ t }}</option>
                {% endfor %}
              </select>
              <button type="submit">Save</button>
            </form>
          </li>
        {% endfor %}
      </ul>
    {% endfor %}

    <div style="margin-top: 30px; padding-top: 20px; border-top: 1px solid #ddd;">
      <form method="post" action="{{ url_for('title_manager') }}">
        <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
        <label for="new_title">Create New Title:</label>
        <input type="text" name="new_title" id="new_title" required placeholder="e.g., Lead Teacher">
        <button type="submit">Add Title</button>
      </form>
    </div>

    <p style="margin-top: 20px;">
      <a href="{{ url_for('index') }}">Back to Home</a>
    </p>
  </div>
{% endblock %}
